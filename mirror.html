<!DOCTYPE html>
<html>
<head>
  <title>Mirror Mode - Smile Booth</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      font-size: 1.2rem;
      padding: 1rem;
    }
    #video {
      width: 90%;
      max-width: 320px;
      margin: 1rem 0;
      border-radius: 10px;
    }
    #message, #compliment, #result {
      margin-top: 1rem;
      font-size: 1.4rem;
    }
    .hidden { display: none; }

    .btn {
      margin-top: 2rem;
      padding: 10px 20px;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .home-btn { background: #28a745; color: white; }
    .exit-btn { background: #dc3545; color: white; margin-left: 10px; }

    .exit-icon {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 1.5rem;
      text-decoration: none;
      color: #444;
    }
  </style>
</head>
<body>

<a href="exit.html" class="exit-icon">‚úñ</a>

<h2>Mirror Mode ü™û</h2>
<p id="message">Smile in 3...2...1...</p>
<video id="video" autoplay></video>
<canvas id="canvas" width="320" height="240" class="hidden"></canvas>

<p id="compliment" class="hidden"></p>
<p id="result" class="hidden"></p>

<div id="nextOptions" class="hidden">
  <button class="btn home-btn" onclick="location.href='index.html'">üè† Go to Home</button>
  <button class="btn exit-btn" onclick="location.href='exit.html'">‚úñ Exit</button>
</div>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const message = document.getElementById('message');
  const complimentText = document.getElementById('compliment');
  const resultText = document.getElementById('result');
  const nextOptions = document.getElementById('nextOptions');

  const compliments = [
    "Such a beautiful smile! üòÑ",
    "You're glowing! üåü",
    "That smile made our day! üíõ",
    "You just spread sunshine! ‚òÄÔ∏è",
    "Smiles like yours make the world brighter! üåà"
  ];

  // Start camera
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
    })
    .catch(err => {
      console.error("Camera error:", err);
      message.textContent = "Unable to access the camera.";
    });

  // Countdown then take photo after 10s
  setTimeout(() => {
    message.textContent = "Capturing your smile...";
    captureAndSend();
  }, 10000);

  function captureAndSend() {
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const base64Image = canvas.toDataURL('image/jpeg');

    fetch('https://myapp-xn74.onrender.com/detect-smile', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image: base64Image })
    })
    .then(res => res.json())
    .then(data => {
      const randomCompliment = compliments[Math.floor(Math.random() * compliments.length)];
      complimentText.textContent = data.message || randomCompliment;
      complimentText.classList.remove('hidden');

      resultText.textContent = "üéâ Your smile has been added to the weekly smile count!";
      resultText.classList.remove('hidden');
      nextOptions.classList.remove('hidden');
    })
    .catch(err => {
      console.error("Error:", err);
      message.textContent = "Something went wrong while analyzing the smile.";
    });
  }
</script>

</body>
</html>
