<!DOCTYPE html>
<html>
<head>
  <title>Draw a Smile</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }
    canvas {
      border: 2px solid #ccc;
      margin-top: 10px;
    }
    #message {
      margin-top: 15px;
      font-size: 1.2em;
      font-weight: bold;
    }
    .nav-btn {
      position: absolute;
      top: 10px;
      font-size: 18px;
      padding: 5px 12px;
      background: #eee;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #exitBtn { left: 10px; }
    #backBtn { right: 10px; }
  </style>
</head>
<body>
  <button id="exitBtn" class="nav-btn" onclick="exitApp()">‚ùå</button>
  <button id="backBtn" class="nav-btn" onclick="goBack()">üîô</button>

  <h2>No worries, draw instead! üé®</h2>

  <canvas id="canvas" width="300" height="200"></canvas><br>

  <button onclick="clearCanvas()">üßΩ Erase</button>
  <button onclick="checkDrawing()">Next ‚û°Ô∏è</button><br><br>

  <div id="textInput" style="display:none;">
    <input type="text" id="reasonInput" placeholder='Type: "I am happy because..."' size="40"><br><br>
    <button onclick="validateText()">OK ‚úÖ</button>
  </div>

  <div id="message"></div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    let points = [];

    canvas.addEventListener("mousedown", () => drawing = true);
    canvas.addEventListener("mouseup", () => drawing = false);
    canvas.addEventListener("mousemove", draw);

    function draw(e) {
      if (!drawing) return;
      const x = e.offsetX;
      const y = e.offsetY;
      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.arc(x, y, 2, 0, Math.PI * 2);
      ctx.fill();
      points.push({ x, y });
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      points = [];
    }

    function checkDrawing() {
      if (points.length < 20) {
        showMessage("Please draw something first.");
        return;
      }

      const isSmileyShape = points.some(p => p.y > 100) && points.some(p => p.y < 80);
      if (!isSmileyShape) {
        showMessage("Draw a smile! üôÇ");
        return;
      }

      // Passed drawing validation
      document.getElementById("textInput").style.display = "block";
      showMessage("Now tell us why you're happy!");
    }

    function validateText() {
      const text = document.getElementById("reasonInput").value.trim();
      if (!text.startsWith("I am happy because")) {
        showMessage("Start with: I am happy because...");
        return;
      }

      showMessage("‚úÖ Well done!");
      setTimeout(() => {
        showMessage("üéâ Your smile has been added to the weekly smile count!");
        setTimeout(() => {
          window.location.href = "index.html";
        }, 3000);
      }, 2000);
    }

    function showMessage(msg) {
      document.getElementById("message").textContent = msg;
    }

    function goBack() {
      window.history.back();
    }

    function exitApp() {
      alert("Can't wait to see your next smile!");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
