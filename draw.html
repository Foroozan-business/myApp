<!DOCTYPE html>
<html>
<head>
  <title>Draw Your Smile üòä</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fff7f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    h2 {
      text-align: center;
      font-size: 24px;
    }

    canvas {
      border: 2px solid #555;
      background-color: white;
      touch-action: none;
    }

    .toolbar {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    #message {
      font-size: 18px;
      color: green;
      margin-top: 15px;
    }

    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      width: 80%;
      max-width: 300px;
      margin: 10px 0;
    }

    .hidden {
      display: none;
    }

    .btn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    .exit, .back {
      position: absolute;
      top: 10px;
      font-size: 18px;
    }

    .exit {
      left: 15px;
    }

    .back {
      right: 15px;
    }
  </style>
</head>
<body>
  <a href="exit.html" class="exit">‚ùå Exit</a>
  <a href="mirror.html" class="back">üîô Back</a>

  <h2>No worries, draw instead!</h2>

  <canvas id="canvas" width="300" height="200"></canvas>

  <div class="toolbar">
    <button onclick="clearCanvas()" class="btn">üßº Erase</button>
    <button onclick="validateSmile()" class="btn">‚û°Ô∏è Next</button>
  </div>

  <div id="textPrompt" class="hidden">
    <p style="margin-top: 15px;">Tell us why you're happy:</p>
    <input id="happyText" type="text" placeholder="I am happy because..." autocomplete="off">
    <button onclick="validateText()" class="btn">‚úÖ OK</button>
  </div>

  <p id="message"></p>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    let paths = [];

    canvas.addEventListener("mousedown", start);
    canvas.addEventListener("mousemove", draw);
    canvas.addEventListener("mouseup", end);
    canvas.addEventListener("mouseout", end);

    function start(e) {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
      paths.push([]);
    }

    function draw(e) {
      if (!drawing) return;
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      paths[paths.length - 1].push([e.offsetX, e.offsetY]);
    }

    function end() {
      drawing = false;
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      paths = [];
      document.getElementById("message").textContent = "";
      document.getElementById("textPrompt").classList.add("hidden");
    }

    function validateSmile() {
      // Require some drawing
      if (paths.length === 0) {
        document.getElementById("message").textContent = "Please draw a smile!";
        return;
      }

      // Simple check: at least one line curved down
      let hasSmile = paths.some(path => {
        let ys = path.map(p => p[1]);
        return ys.length > 3 && ys[0] > ys[Math.floor(ys.length / 2)] && ys[ys.length - 1] > ys[Math.floor(ys.length / 2)];
      });

      if (!hasSmile) {
        document.getElementById("message").textContent = "Draw a real smile! üòä";
        return;
      }

      // Show text prompt
      document.getElementById("textPrompt").classList.remove("hidden");
      document.getElementById("happyText").value = "";
      document.getElementById("message").textContent = "";
    }

    function validateText() {
      const input = document.getElementById("happyText").value.trim();
      if (!input.toLowerCase().startsWith("i am happy because")) {
        document.getElementById("message").textContent = "Please start with: I am happy because...";
        return;
      }

      document.getElementById("message").textContent = "‚úÖ Well done!";
      setTimeout(() => {
        window.location.href = "done.html";
      }, 2500);
    }
  </script>
</body>
</html>
