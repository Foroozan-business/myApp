<script>
  let smilingSeconds = 0;
  let timerInterval;
  const compliments = [
    "You're glowing today! âœ¨",
    "That smile could light up a room! ðŸŒŸ",
    "You look amazing when you smile ðŸ˜",
    "Smiling suits you so well ðŸ˜Š",
    "Thatâ€™s the spirit! Keep shining!"
  ];

  function startSmileDetection() {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const message = document.getElementById('message');
    const hand = document.getElementById('hand');

    timerInterval = setInterval(() => {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const image = canvas.toDataURL('image/jpeg');

      fetch('https://myapp-xn74.onrender.com/detect-smile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ image })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success && data.message.includes("beautiful")) {
          smilingSeconds++;
          hand.textContent = `ðŸ– ${smilingSeconds}`;
          message.textContent = `Keep smiling... ${smilingSeconds}s`;

          if (smilingSeconds >= 10) {
            clearInterval(timerInterval);
            hand.textContent = "ðŸ‘";
            message.innerHTML = `ðŸŽ‰ ${compliments[Math.floor(Math.random() * compliments.length)]}`;
            setTimeout(() => {
              let count = parseInt(localStorage.getItem("weeklySmileCount") || 0);
              localStorage.setItem("weeklySmileCount", count + 1);
              window.location.href = "done.html";
            }, 3000);
          }
        } else {
          smilingSeconds = 0;
          hand.textContent = "";
          message.textContent = "Try for a real smile ðŸ˜";
        }
      })
      .catch(err => {
        console.error("Smile detection error:", err);
        message.textContent = "Error detecting smile.";
        clearInterval(timerInterval);
      });
    }, 1000);
  }
</script>
