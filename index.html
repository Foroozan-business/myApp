<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const resultText = document.getElementById('result');

  // Show live camera preview
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => { video.srcObject = stream; })
    .catch(err => { console.error("Camera error:", err); });

  function takePhoto() {
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    
    const base64Image = canvas.toDataURL('image/jpeg');

    // DEBUG: print base64 image to console
    console.log("Captured image length:", base64Image.length);

    // Send to Render API
    fetch('https://myapp-xn74.onrender.com/detect-smile', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image: base64Image })
    })
    .then(res => res.json())
    .then(data => {
      console.log("API response:", data);
      resultText.textContent = data.message || "Something went wrong!";
    })
    .catch(err => {
      console.error("Fetch error:", err);
      resultText.textContent = "Failed to analyze image.";
    });
  }
</script>
